<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AUTOå®˜ç¶²ç”¢å“ä¸Šæ¶åŠç¶­è­·ç®¡ç†ç³»çµ±</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: linear-gradient(135deg, #8B7D82 0%, #6B5B73 100%);
min-height: 100vh;
color: #333;
line-height: 1.6;
}

.container {
max-width: 1400px;
margin: 0 auto;
padding: 20px;
}

.header {
text-align: center;
margin-bottom: 30px;
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
padding: 40px;
border-radius: 20px;
box-shadow: 0 8px 32px rgba(0,0,0,0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
}

.header h1 {
background: linear-gradient(135deg, #8B7D82 0%, #6B5B73 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
font-size: 2.8em;
margin-bottom: 15px;
font-weight: 700;
letter-spacing: -1px;
}

.mode-indicator {
display: inline-block;
padding: 10px 25px;
border-radius: 25px;
font-weight: 600;
margin-top: 15px;
font-size: 14px;
text-transform: uppercase;
letter-spacing: 1px;
}

.mode-selector {
margin-bottom: 20px;
display: flex;
align-items: center;
justify-content: center;
gap: 15px;
}

.mode-selector label {
font-weight: 600;
color: #2c3e50;
font-size: 16px;
}

.mode-selector select {
padding: 12px 20px;
border: 2px solid transparent;
border-radius: 12px;
font-size: 14px;
font-weight: 600;
background: linear-gradient(135deg, #8B7D82 0%, #6B5B73 100%);
color: white;
cursor: pointer;
transition: all 0.3s ease;
}

.mode-selector select:hover {
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(139, 125, 130, 0.4);
}

.mode-selector select:focus {
outline: none;
box-shadow: 0 0 0 3px rgba(139, 125, 130, 0.3);
}

.mode-selector select option {
background: white;
color: #333;
padding: 10px;
}

.mode-new {
background: linear-gradient(135deg, #A8956F 0%, #8B7355 100%);
color: white;
box-shadow: 0 4px 15px rgba(168, 149, 111, 0.3);
}

.mode-update {
background: linear-gradient(135deg, #8B7D82 0%, #6B5B73 100%);
color: white;
box-shadow: 0 4px 15px rgba(139, 125, 130, 0.3);
}

.basic-info, .ai-content {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(15px);
padding: 35px;
border-radius: 20px;
margin-bottom: 25px;
box-shadow: 0 8px 32px rgba(0,0,0,0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
transition: transform 0.3s ease;
}

.basic-info:hover, .ai-content:hover {
transform: translateY(-2px);
}

.basic-info h2, .ai-content h2 {
font-size: 1.8em;
margin-bottom: 30px;
font-weight: 700;
position: relative;
padding-bottom: 15px;
}

.basic-info h2 {
background: linear-gradient(135deg, #8B7D82 0%, #6B5B73 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.basic-info h2::after {
content: '';
position: absolute;
bottom: 0;
left: 0;
width: 60px;
height: 4px;
background: linear-gradient(135deg, #8B7D82 0%, #6B5B73 100%);
border-radius: 2px;
}

.ai-content h2 {
color: #A8956F;
}

.ai-content h2::after {
content: '';
position: absolute;
bottom: 0;
left: 0;
width: 60px;
height: 4px;
background: linear-gradient(135deg, #A8956F 0%, #8B7355 100%);
border-radius: 2px;
}

.form-row {
display: flex;
gap: 25px;
margin-bottom: 25px;
align-items: end;
}

.form-group {
flex: 1;
}

.form-group label {
display: block;
margin-bottom: 10px;
font-weight: 600;
color: #2c3e50;
font-size: 14px;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.required {
color: #C5705D;
font-weight: 700;
}

.form-group input, .form-group textarea, .form-group select {
width: 100%;
padding: 15px 20px;
border: 2px solid #e8eaf6;
border-radius: 12px;
font-size: 15px;
transition: all 0.3s ease;
background: rgba(255, 255, 255, 0.8);
backdrop-filter: blur(5px);
}

.form-group select {
cursor: pointer;
}

.form-group input:focus, .form-group textarea:focus, .form-group select:focus {
outline: none;
border-color: #8B7D82;
box-shadow: 0 0 0 3px rgba(139, 125, 130, 0.1);
transform: translateY(-1px);
}

.form-group input:disabled, .form-group select:disabled {
background-color: #f5f5f5;
color: #6c757d;
cursor: not-allowed;
}

.custom-input-container {
display: none;
margin-top: 10px;
}

.custom-input-container.show {
display: block;
}

.check-btn {
background: linear-gradient(135deg, #8B7D82 0%, #6B5B73 100%);
color: white;
border: none;
padding: 15px 25px;
border-radius: 12px;
cursor: pointer;
font-weight: 600;
transition: all 0.3s ease;
text-transform: uppercase;
letter-spacing: 1px;
font-size: 14px;
}

.check-btn:hover {
transform: translateY(-3px);
box-shadow: 0 10px 25px rgba(139, 125, 130, 0.4);
}

.generate-btn {
background: linear-gradient(135deg, #A8956F 0%, #8B7355 100%);
color: white;
border: none;
padding: 18px 40px;
border-radius: 50px;
font-size: 16px;
font-weight: 700;
cursor: pointer;
margin: 30px auto;
display: block;
transition: all 0.3s ease;
text-transform: uppercase;
letter-spacing: 1px;
position: relative;
overflow: hidden;
}

.generate-btn::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
transition: left 0.5s;
}

.generate-btn:hover::before {
left: 100%;
}

.generate-btn:hover {
transform: translateY(-3px);
box-shadow: 0 15px 35px rgba(168, 149, 111, 0.4);
}

.generate-btn:disabled {
background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
cursor: not-allowed;
transform: none;
box-shadow: none;
}

.warning-text {
background: linear-gradient(135deg, #E6C2A6 0%, #D4A574 100%);
color: #8b4513;
padding: 15px 20px;
border-radius: 12px;
margin-bottom: 25px;
border-left: 5px solid #C5705D;
font-weight: 600;
display: flex;
align-items: center;
gap: 10px;
}

.section {
margin-bottom: 35px;
}

.section-title {
background: linear-gradient(135deg, #8B7D82 0%, #6B5B73 100%);
color: white;
padding: 15px 25px;
margin-bottom: 20px;
border-radius: 12px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
display: flex;
align-items: center;
justify-content: space-between;
box-shadow: 0 4px 15px rgba(139, 125, 130, 0.3);
}

.section-title:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(139, 125, 130, 0.4);
}

.section-title::before {
content: "â–¼";
font-size: 12px;
transition: transform 0.3s ease;
}

.section.collapsed .section-title::before {
transform: rotate(-90deg);
}

.section.collapsed .section-content {
display: none;
}

.field-row {
display: flex;
gap: 25px;
margin-bottom: 25px;
align-items: stretch;
}

.original-data, .ai-data {
flex: 1;
border-radius: 15px;
padding: 20px;
transition: all 0.3s ease;
position: relative;
overflow: hidden;
}

.original-data {
background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
border: 2px solid #dee2e6;
}

.original-data .field-content {
white-space: pre-line;
}

.original-data::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 4px;
background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
}

.ai-data {
background: linear-gradient(135deg, #F0EFEF 0%, #E8E3E3 100%);
border: 2px solid #B5A7A7;
}

.ai-data::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 4px;
background: linear-gradient(135deg, #8B7D82 0%, #6B5B73 100%);
}

.field-header {
font-weight: 700;
margin-bottom: 15px;
color: #2c3e50;
font-size: 14px;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.field-content {
min-height: 60px;
}

.field-content textarea, .field-content input {
width: 100%;
min-height: 80px;
border: 2px solid #e8eaf6;
border-radius: 10px;
padding: 12px 15px;
resize: vertical;
font-family: inherit;
transition: all 0.3s ease;
background: rgba(255, 255, 255, 0.9);
}

.review-badge {
background: linear-gradient(135deg, #C5705D 0%, #A85A47 100%);
color: white;
padding: 3px 8px;
border-radius: 12px;
font-size: 11px;
font-weight: 700;
margin-left: 8px;
text-transform: uppercase;
letter-spacing: 0.5px;
box-shadow: 0 2px 4px rgba(197, 112, 93, 0.3);
animation: pulse 2s infinite;
}

@keyframes pulse {
0% { box-shadow: 0 2px 4px rgba(197, 112, 93, 0.3); }
50% { box-shadow: 0 2px 8px rgba(197, 112, 93, 0.6); }
100% { box-shadow: 0 2px 4px rgba(197, 112, 93, 0.3); }
}

.field-content textarea:focus, .field-content input:focus {
border-color: #8B7D82;
box-shadow: 0 0 0 3px rgba(139, 125, 130, 0.1);
outline: none;
}

.refresh-btn {
background: linear-gradient(135deg, #7FB069 0%, #588157 100%);
color: white;
border: none;
padding: 8px 15px;
border-radius: 20px;
cursor: pointer;
font-size: 12px;
font-weight: 600;
margin-top: 10px;
transition: all 0.3s ease;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.refresh-btn:hover {
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(127, 176, 105, 0.4);
}

.refresh-btn:disabled {
background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
cursor: not-allowed;
transform: none;
box-shadow: none;
}

.loading {
display: none;
text-align: center;
padding: 30px;
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(15px);
border-radius: 20px;
margin-bottom: 25px;
box-shadow: 0 8px 32px rgba(0,0,0,0.1);
}

.loading.show {
display: block;
}

.loading-content {
display: flex;
align-items: center;
justify-content: center;
gap: 15px;
color: #8B7D82;
font-weight: 600;
font-size: 18px;
}

.spinner {
display: inline-block;
animation: spin 2s linear infinite;
font-size: 24px;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

.action-buttons {
text-align: center;
padding: 40px;
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(15px);
border-radius: 20px;
box-shadow: 0 8px 32px rgba(0,0,0,0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
}

.action-btn {
padding: 15px 35px;
margin: 0 15px;
border: none;
border-radius: 50px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
text-transform: uppercase;
letter-spacing: 1px;
position: relative;
overflow: hidden;
}

.action-btn::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
transition: left 0.5s;
}

.action-btn:hover::before {
left: 100%;
}

.save-btn {
background: linear-gradient(135deg, #7FB069 0%, #588157 100%);
color: white;
box-shadow: 0 4px 15px rgba(127, 176, 105, 0.3);
}

.save-btn:hover {
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(127, 176, 105, 0.4);
}

.preview-btn {
background: linear-gradient(135deg, #8B7D82 0%, #6B5B73 100%);
color: white;
box-shadow: 0 4px 15px rgba(139, 125, 130, 0.3);
}

.preview-btn:hover {
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(139, 125, 130, 0.4);
}

.clear-btn {
background: linear-gradient(135deg, #C5705D 0%, #A85A47 100%);
color: white;
box-shadow: 0 4px 15px rgba(197, 112, 93, 0.3);
}

.clear-btn:hover {
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(197, 112, 93, 0.4);
}

.checkbox-group {
margin-top: 10px;
display: flex;
gap: 30px;
align-items: center;
}

.checkbox-option {
display: inline-block;
cursor: pointer;
font-weight: 500;
color: #2c3e50;
font-size: 15px;
padding: 8px 12px;
border-radius: 8px;
transition: all 0.3s ease;
position: relative;
padding-left: 35px;
white-space: nowrap;
}

.checkbox-option:hover {
background: rgba(139, 125, 130, 0.05);
}

.checkbox-option input[type="checkbox"] {
display: none;
}

.checkbox-custom {
width: 20px;
height: 20px;
border: 2px solid #8B7D82;
border-radius: 4px;
position: absolute;
left: 8px;
top: 50%;
transform: translateY(-50%);
background: white;
box-sizing: border-box;
}

.checkbox-option input[type="checkbox"]:checked + .checkbox-custom {
background: #8B7D82;
border-color: #8B7D82;
}

.checkbox-option input[type="checkbox"]:checked + .checkbox-custom::after {
content: 'âœ“';
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
color: white;
font-size: 14px;
font-weight: bold;
line-height: 1;
}

.help-text-inline {
color: #C5705D;
font-size: 12px;
font-style: italic;
font-weight: normal;
margin-left: 8px;
}

.radio-group {
margin-top: 10px;
display: flex;
gap: 30px;
align-items: center;
}

.radio-option {
display: inline-block;
cursor: pointer;
font-weight: 500;
color: #2c3e50;
font-size: 15px;
padding: 8px 12px;
border-radius: 8px;
transition: all 0.3s ease;
position: relative;
padding-left: 35px;
white-space: nowrap;
}

.radio-option:hover {
background: rgba(139, 125, 130, 0.05);
}

.radio-option input[type="radio"] {
display: none;
}

.radio-custom {
width: 20px;
height: 20px;
border: 2px solid #8B7D82;
border-radius: 50%;
position: absolute;
left: 8px;
top: 50%;
transform: translateY(-50%);
background: white;
box-sizing: border-box;
}

.radio-option input[type="radio"]:checked + .radio-custom {
border-color: #8B7D82;
}

.radio-option input[type="radio"]:checked + .radio-custom::after {
content: '';
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
width: 10px;
height: 10px;
border-radius: 50%;
background: #8B7D82;
}

.fade-in {
animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 768px) {
.container {
padding: 15px;
}

.form-row, .field-row {
flex-direction: column;
gap: 20px;
}

.action-btn {
display: block;
width: 100%;
margin: 10px 0;
}

.header h1 {
font-size: 2.2em;
}

.mode-selector {
flex-direction: column;
gap: 10px;
}

.basic-info, .ai-content {
padding: 25px;
}

.checkbox-group {
flex-direction: column;
gap: 10px;
align-items: flex-start;
}
}

@media (prefers-color-scheme: dark) {
.original-data {
background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
border-color: #4a5568;
color: #e2e8f0;
}

.ai-data {
background: linear-gradient(135deg, #3a3a3a 0%, #4a4a4a 100%);
border-color: #6B5B73;
color: #e2e8f0;
}

.field-header {
color: #e2e8f0;
}
}

.form-group input:valid {
border-color: #7FB069;
}

.form-group input:invalid:not(:placeholder-shown) {
border-color: #C5705D;
}

::-webkit-scrollbar {
width: 8px;
}

::-webkit-scrollbar-track {
background: rgba(255, 255, 255, 0.1);
border-radius: 4px;
}

::-webkit-scrollbar-thumb {
background: linear-gradient(135deg, #8B7D82 0%, #6B5B73 100%);
border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
background: linear-gradient(135deg, #6B5B73 0%, #534652 100%);
}
</style>
</head>
<body>
<div class="container">
<!-- Header -->
<div class="header">
<h1>ğŸš— AUTOå®˜ç¶²ç”¢å“ä¸Šæ¶åŠç¶­è­·ç®¡ç†ç³»çµ±</h1>
<div class="mode-selector">
<label for="operationMode">æ“ä½œæ¨¡å¼ï¼š</label>
<select id="operationMode" onchange="changeMode()">
<option value="new">æ–°å¢ç”¢å“</option>
<option value="update">ä¿®æ”¹ç”¢å“</option>
</select>
</div>
<div class="mode-indicator mode-new" id="modeIndicator">æ–°å¢æ¨¡å¼</div>
</div>

<!-- Basic Information -->
<div class="basic-info">
<h2>ğŸ“ åŸºæœ¬è³‡è¨Š</h2>

<div class="form-row">
<div class="form-group">
<label for="systemId">ç”¢å“ç³»çµ±ID(Aæ¬„) <span class="required">*</span></label>
<input type="text" id="systemId" placeholder="è«‹è¼¸å…¥ç”¢å“ç³»çµ±ID">
</div>
<div id="checkSystemIdSection">
<button type="button" class="check-btn" onclick="checkSystemId()">æª¢æŸ¥IDæ˜¯å¦é‡è¤‡</button>
</div>
<div id="loadSystemIdSection" style="display: none;">
<button type="button" class="check-btn" onclick="loadExistingProductBySystemId()">è¼‰å…¥è³‡æ–™</button>
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="categoryId">åˆ†é¡ç³»çµ±ID(Bæ¬„) <span class="required">*</span></label>
<select id="categoryId">
<option value="">è¼‰å…¥ä¸­...</option>
</select>
<div class="custom-input-container" id="customCategoryContainer">
<input type="text" id="customCategoryId" placeholder="è«‹è¼¸å…¥æ–°çš„åˆ†é¡ç³»çµ±ID">
</div>
</div>
<div class="form-group">
<label for="productName">ç”¢å“åç¨±(Cæ¬„) <span class="required">*</span></label>
<input type="text" id="productName" placeholder="è«‹è¼¸å…¥ç”¢å“åç¨±">
</div>
<div class="form-group">
<label for="productModel">ç”¢å“å‹è™Ÿ(Dæ¬„) <span class="required">*</span></label>
<input type="text" id="productModel" placeholder="è«‹è¼¸å…¥ç”¢å“å‹è™Ÿ">
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="maker">Maker(Mæ¬„)</label>
<input type="text" id="maker" placeholder="è«‹è¼¸å…¥è£½é€ å•†">
</div>
<div class="form-group">
<label for="model">Model(Næ¬„)</label>
<textarea id="model" rows="2" placeholder="è«‹è¼¸å…¥è»Šå‹"></textarea>
</div>
<div class="form-group">
<label for="year">YEAR(Oæ¬„)</label>
<textarea id="year" rows="2" placeholder="è«‹è¼¸å…¥å¹´ä»½"></textarea>
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="oeNumber">OE#(ABæ¬„)</label>
<textarea id="oeNumber" rows="2" placeholder="è«‹è¼¸å…¥OEç·¨è™Ÿ" style="height: 60px;"></textarea>
</div>
<div class="form-group">
<label for="pins">PINs(Sæ¬„) <span class="help-text-inline">è«‹å¡«æ•¸å­—æˆ–æ˜¯N/A</span></label>
<input type="text" id="pins" placeholder="è«‹å¡«æ•¸å­—æˆ–æ˜¯N/A" style="height: 50px;">
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="manualElectric">Manual/Electric(Tæ¬„)</label>
<div class="radio-group">
<label class="radio-option">
<input type="radio" name="manualElectric" value="Manual">
<span class="radio-custom"></span>
Manual
</label>
<label class="radio-option">
<input type="radio" name="manualElectric" value="Electric">
<span class="radio-custom"></span>
Electric
</label>
</div>
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="supplierInfo">å…¶ä»–å» å•†è£œå……è³‡æ–™</label>
<textarea id="supplierInfo" rows="3" placeholder="éå¿…å¡«ï¼Œä¾›AIåƒè€ƒ"></textarea>
<div class="help-text">å¯æä¾›å» å•†çš„ç”¢å“è¦æ ¼ã€ç‰¹è‰²èªªæ˜ç­‰è³‡æ–™</div>
</div>
</div>

<button type="button" class="generate-btn" onclick="generateAIContent()" id="generateBtn">
ğŸ¤– ç”ŸæˆAIæ–‡æ¡ˆ
</button>
</div>

<!-- Loading -->
<div class="loading" id="loadingDiv">
<div class="loading-content">
<span class="spinner">ğŸ¤–</span>
<span>AI æ­£åœ¨ç‚ºæ‚¨ç”Ÿæˆç²¾å½©å…§å®¹ï¼Œè«‹ç¨å€™...</span>
</div>
</div>

<!-- AI Generated Content -->
<div class="ai-content fade-in" id="aiContent">
<h2>ğŸ¤– AIç”Ÿæˆå…§å®¹</h2>
<div class="warning-text">
âš ï¸ ä»¥ä¸‹å…§å®¹ç”±AIç”Ÿæˆï¼Œè«‹ä»”ç´°ç¢ºèªä¸¦ä¿®æ”¹å¾Œå†å„²å­˜
</div>

<!-- åŸºæœ¬è³‡è¨Š -->
<div class="section">
<div class="section-title" onclick="toggleSection(this)">åŸºæœ¬è³‡è¨Š</div>
<div class="section-content">
<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“åˆ¥ç¨±(Eæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalAlias">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“åˆ¥ç¨±(Eæ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiAlias" rows="3"></textarea>
<button class="refresh-btn" onclick="refreshField('alias')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“åœ–ç‰‡(Fæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalImage">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“åœ–ç‰‡(Fæ¬„) - è‡ªå‹•ç”Ÿæˆ</div>
<div class="field-content">
<input type="text" id="aiImage">
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“åœ–ç‰‡èªªæ˜(Gæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalImageDesc">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“åœ–ç‰‡èªªæ˜(Gæ¬„) - è‡ªå‹•ç”Ÿæˆ</div>
<div class="field-content">
<input type="text" id="aiImageDesc">
</div>
</div>
</div>
</div>
</div>

<!-- ç”¢å“æè¿° -->
<div class="section">
<div class="section-title" onclick="toggleSection(this)">ç”¢å“æè¿°</div>
<div class="section-content">
<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“ç°¡è¿°(Iæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalDesc">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“ç°¡è¿°(Iæ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiDesc" rows="10"></textarea>
<button class="refresh-btn" onclick="refreshField('desc')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“æ‡‰ç”¨(Pæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalApplication">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“æ‡‰ç”¨(Pæ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiApplication" rows="4"></textarea>
<button class="refresh-btn" onclick="refreshField('application')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">Type(Qæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalType">-</div>
</div>
<div class="ai-data">
<div class="field-header">Type(Qæ¬„) - AIç”Ÿæˆ</div>
<div class="field-content">
<input type="text" id="aiType">
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">Position(Ræ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalPosition">-</div>
</div>
<div class="ai-data">
<div class="field-header">Position(Ræ¬„) - AIç”Ÿæˆ</div>
<div class="field-content">
<input type="text" id="aiPosition">
</div>
</div>
</div>
</div>
</div>

<!-- ç”¢å“è¦æ ¼èˆ‡ä¿å›º -->
<div class="section">
<div class="section-title" onclick="toggleSection(this)">ç”¢å“è¦æ ¼èˆ‡ä¿å›º</div>
<div class="section-content">
<div class="field-row">
<div class="original-data">
<div class="field-header">Country of Origin(AAæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalCountry">-</div>
</div>
<div class="ai-data">
<div class="field-header">Country of Origin(AAæ¬„) - è‡ªå‹•ç”Ÿæˆ</div>
<div class="field-content">
<input type="text" id="aiCountry" value="Made in Taiwan">
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">Warranty(AFæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalWarranty">-</div>
</div>
<div class="ai-data">
<div class="field-header">Warranty(AFæ¬„) - è‡ªå‹•ç”Ÿæˆ</div>
<div class="field-content">
<input type="text" id="aiWarranty" value="12 Months">
</div>
</div>
</div>
</div>
</div>

<!-- SEOæ¨™ç±¤ -->
<div class="section">
<div class="section-title" onclick="toggleSection(this)">SEOæ¨™ç±¤</div>
<div class="section-content">
<div class="field-row">
<div class="original-data">
<div class="field-header">TAGæ¨™ç±¤(AKæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalTags">-</div>
</div>
<div class="ai-data">
<div class="field-header">TAGæ¨™ç±¤(AKæ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiTags" rows="2"></textarea>
<button class="refresh-btn" onclick="refreshField('tags')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Action Buttons -->
<div class="action-buttons">
<button type="button" class="action-btn preview-btn" onclick="previewData()">ğŸ‘ï¸ é è¦½è³‡æ–™</button>
<button type="button" class="action-btn save-btn" onclick="saveData()">ğŸ’¾ å„²å­˜ç”¢å“</button>
<button type="button" class="action-btn clear-btn" onclick="clearForm()">ğŸ—‘ï¸ æ¸…ç©ºè¡¨å–®</button>
</div>
</div>

<script>
let isUpdateMode = false;
let currentProductData = {};

// é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    loadCategoryOptions();
    setupRadioToggle();
    
    // ç›£è½åˆ†é¡é¸æ“‡è®Šæ›´
    document.getElementById('categoryId').addEventListener('change', handleCategoryChange);
    
    // Enteréµäº‹ä»¶è™•ç†
    document.getElementById('systemId').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            const mode = document.getElementById('operationMode').value;
            if (mode === 'update') {
                loadExistingProductBySystemId();
            } else {
                checkSystemId();
            }
        }
    });
    
    // ç›£è½ Manual/Electric å’Œ PINs è®ŠåŒ–ä¾†è‡ªå‹•ç”Ÿæˆ Type
    document.querySelectorAll('input[name="manualElectric"]').forEach(radio => {
        radio.addEventListener('change', generateTypeField);
    });
    document.getElementById('pins').addEventListener('input', generateTypeField);
});

// è¨­ç½®å–®é¸æŒ‰éˆ•å¯å–æ¶ˆåŠŸèƒ½
function setupRadioToggle() {
    const radioInputs = document.querySelectorAll('input[name="manualElectric"]');
    let lastChecked = null;

    radioInputs.forEach(radio => {
        radio.addEventListener('click', function() {
            if (this === lastChecked) {
                // å¦‚æœé»æ“Šçš„æ˜¯å·²é¸ä¸­çš„é …ç›®ï¼Œå‰‡å–æ¶ˆé¸æ“‡
                this.checked = false;
                lastChecked = null;
                // å–æ¶ˆé¸æ“‡æ™‚ä¹Ÿè¦æ›´æ–° Type æ¬„ä½
                generateTypeField();
            } else {
                // å¦å‰‡æ­£å¸¸é¸æ“‡
                lastChecked = this;
                // é¸æ“‡æ™‚æ›´æ–° Type æ¬„ä½
                generateTypeField();
            }
        });
    });
}

// è‡ªå‹•ç”Ÿæˆ Type æ¬„ä½
function generateTypeField() {
    const manualElectricInputs = document.querySelectorAll('input[name="manualElectric"]');
    const pinsValue = document.getElementById('pins').value.trim().toUpperCase();
    let selectedType = null;
    
    // æª¢æŸ¥å“ªå€‹é¸é …è¢«é¸ä¸­
    manualElectricInputs.forEach(input => {
        if (input.checked) {
            selectedType = input.value;
        }
    });
    
    let typeValue = '';
    
    if (selectedType === 'Manual') {
        typeValue = 'Manual Window Regulator';
    } else if (selectedType === 'Electric') {
        if (pinsValue && pinsValue !== 'N/A') {
            // å¦‚æœæœ‰å¡«æ•¸å­—
            typeValue = 'Power Window Regulator with Motor';
        } else if (pinsValue === 'N/A') {
            // å¦‚æœå¡« N/A
            typeValue = 'Power Window Regulator without Motor';
        } else {
            // å¦‚æœ PINs æ¬„ä½ç‚ºç©º
            typeValue = 'Power Window Regulator';
        }
    }
    
    // æ›´æ–° Type æ¬„ä½
    document.getElementById('aiType').value = typeValue;
}

// è¼‰å…¥åˆ†é¡é¸é …
function loadCategoryOptions() {
    fetch('https://hook.us2.make.com/0p5lig54uyqpz5r7mt7xoldqo7x0c6mt', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            action: 'get_category_options'
        })
    })
    .then(response => response.json())
    .then(data => {
        const categorySelect = document.getElementById('categoryId');
        categorySelect.innerHTML = '';
        
        // æ·»åŠ é è¨­é¸é …
        categorySelect.innerHTML = '<option value="">è«‹é¸æ“‡åˆ†é¡ç³»çµ±ID</option>';
        
        if (data.success && data.categories) {
            data.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }
        
        // æ·»åŠ æ–°å¢é¸é …
        const addOption = document.createElement('option');
        addOption.value = 'add_new';
        addOption.textContent = 'æ–°å¢åˆ†é¡ç³»çµ±ID';
        categorySelect.appendChild(addOption);
    })
    .catch(error => {
        console.error('è¼‰å…¥åˆ†é¡é¸é …å¤±æ•—:', error);
        document.getElementById('categoryId').innerHTML = '<option value="">è¼‰å…¥å¤±æ•—</option>';
    });
}

// è™•ç†åˆ†é¡é¸æ“‡è®Šæ›´
function handleCategoryChange() {
    const categorySelect = document.getElementById('categoryId');
    const customContainer = document.getElementById('customCategoryContainer');
    
    if (categorySelect.value === 'add_new') {
        customContainer.classList.add('show');
        document.getElementById('customCategoryId').focus();
    } else {
        customContainer.classList.remove('show');
    }
}

// åˆ‡æ›æ¨¡å¼
function changeMode() {
    const mode = document.getElementById('operationMode').value;
    const checkSystemIdSection = document.getElementById('checkSystemIdSection');
    const loadSystemIdSection = document.getElementById('loadSystemIdSection');
    const systemIdInput = document.getElementById('systemId');
    
    if (mode === 'update') {
        switchToUpdateMode();
        checkSystemIdSection.style.display = 'none';
        loadSystemIdSection.style.display = 'block';
        systemIdInput.placeholder = 'è«‹è¼¸å…¥è¦ä¿®æ”¹çš„ç”¢å“ç³»çµ±ID';
    } else {
        switchToNewMode();
        checkSystemIdSection.style.display = 'block';
        loadSystemIdSection.style.display = 'none';
        systemIdInput.placeholder = 'è«‹è¼¸å…¥ç”¢å“ç³»çµ±ID';
        clearForm();
    }
}

function switchToUpdateMode() {
    isUpdateMode = true;
    const indicator = document.getElementById('modeIndicator');
    indicator.textContent = 'æ›´æ–°æ¨¡å¼';
    indicator.className = 'mode-indicator mode-update';
}

function switchToNewMode() {
    isUpdateMode = false;
    const indicator = document.getElementById('modeIndicator');
    indicator.textContent = 'æ–°å¢æ¨¡å¼';
    indicator.className = 'mode-indicator mode-new';
    
    // è§£é–æ‰€æœ‰å¿…å¡«æ¬„ä½
    document.getElementById('systemId').disabled = false;
    document.getElementById('productModel').disabled = false;
    document.getElementById('categoryId').disabled = false;
    document.getElementById('customCategoryId').disabled = false;
    document.getElementById('productName').disabled = false;
}

// æª¢æŸ¥ç”¢å“ç³»çµ±ID
function checkSystemId() {
    const systemId = document.getElementById('systemId').value.trim();
    if (!systemId) {
        alert('è«‹è¼¸å…¥ç”¢å“ç³»çµ±ID');
        return;
    }
    
    const checkBtn = document.querySelector('#checkSystemIdSection .check-btn');
    checkBtn.disabled = true;
    checkBtn.textContent = 'æª¢æŸ¥ä¸­...';
    
    console.log('ç™¼é€ç³»çµ±IDæª¢æŸ¥è«‹æ±‚:', {
        action: 'check_system_id',
        systemId: systemId
    });
    
    fetch('https://hook.us2.make.com/0p5lig54uyqpz5r7mt7xoldqo7x0c6mt', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            action: 'check_system_id',
            systemId: systemId
        })
    })
    .then(response => {
        console.log('Response status:', response.status);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.text();
    })
    .then(rawText => {
        console.log('Raw response text:', rawText);
        
        const cleanText = rawText
            .replace(/[\u0000-\u001F\u007F-\u009F]/g, '')
            .replace(/\r\n/g, '\\n')
            .replace(/\r/g, '\\n')
            .replace(/\n/g, '\\n')
            .replace(/\t/g, '\\t');
        
        try {
            const data = JSON.parse(cleanText);
            return data;
        } catch (parseError) {
            console.error('JSON è§£æéŒ¯èª¤:', parseError);
            const superCleanText = rawText.replace(/[\x00-\x1F\x7F]/g, ' ');
            const data = JSON.parse(superCleanText);
            return data;
        }
    })
    .then(data => {
        console.log('æ”¶åˆ°çš„æª¢æŸ¥çµæœ:', data);
        
        if (data.exists) {
            alert('æ­¤ç”¢å“ç³»çµ±IDå·²å­˜åœ¨ï¼è«‹ä½¿ç”¨ä¸åŒçš„IDæˆ–åˆ‡æ›åˆ°ä¿®æ”¹æ¨¡å¼ã€‚');
        } else {
            alert('ç”¢å“ç³»çµ±IDå¯ç”¨ï¼');
        }
    })
    .catch(error => {
        console.error('æª¢æŸ¥å¤±æ•—è©³ç´°éŒ¯èª¤:', error);
        
        if (error.message.includes('JSON')) {
            alert('è³‡æ–™æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ Make.com å›å‚³çš„è³‡æ–™æ ¼å¼ã€‚è©³ç´°éŒ¯èª¤è«‹æŸ¥çœ‹ç€è¦½å™¨æ§åˆ¶å°ã€‚');
        } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
            alert('ç¶²è·¯è«‹æ±‚å¤±æ•—ï¼Œå¯èƒ½æ˜¯CORSå•é¡Œã€‚è«‹æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°æŸ¥çœ‹è©³ç´°éŒ¯èª¤ã€‚');
        } else {
            alert(`æª¢æŸ¥å¤±æ•—: ${error.message}`);
        }
    })
    .finally(() => {
        checkBtn.disabled = false;
        checkBtn.textContent = 'æª¢æŸ¥IDæ˜¯å¦é‡è¤‡';
    });
}

// é€šéç³»çµ±IDè¼‰å…¥ç¾æœ‰ç”¢å“
function loadExistingProductBySystemId() {
    const systemId = document.getElementById('systemId').value.trim();
    if (!systemId) {
        alert('è«‹è¼¸å…¥ç”¢å“ç³»çµ±ID');
        return;
    }
    
    const loadBtn = document.querySelector('#loadSystemIdSection .check-btn');
    loadBtn.disabled = true;
    loadBtn.textContent = 'è¼‰å…¥ä¸­...';
    
    console.log('ç™¼é€ç³»çµ±IDè¼‰å…¥è«‹æ±‚:', {
        action: 'load_by_system_id',
        systemId: systemId
    });
    
    fetch('https://hook.us2.make.com/0p5lig54uyqpz5r7mt7xoldqo7x0c6mt', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            action: 'load_by_system_id',
            systemId: systemId
        })
    })
    .then(response => {
        console.log('Response status:', response.status);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.text();
    })
    .then(rawText => {
        console.log('Raw response text:', rawText);
        
        // é‡å°æ ¼å¼åŒ– JSON çš„æ¸…ç†ç­–ç•¥
        let cleanText = rawText
            .trim()                                    // ç§»é™¤å‰å¾Œç©ºç™½
            .replace(/^\uFEFF/, '');                   // ç§»é™¤ BOM
        
        console.log('Simply cleaned text:', cleanText);
        
        try {
            // ç›´æ¥å˜—è©¦è§£æï¼Œä¸åšéåº¦æ¸…ç†
            const data = JSON.parse(cleanText);
            console.log('JSON è§£ææˆåŠŸ:', data);
            return data;
        } catch (parseError) {
            console.error('ç›´æ¥è§£æå¤±æ•—:', parseError);
            
            // ç¬¬äºŒæ¬¡å˜—è©¦ï¼šç§»é™¤æ ¼å¼åŒ–ä½†ä¿æŒ JSON çµæ§‹
            let compactText = rawText
                .trim()
                .replace(/\r\n/g, '')                     // ç§»é™¤æ‰€æœ‰æ›è¡Œç¬¦
                .replace(/\r/g, '')
                .replace(/\n/g, '')
                .replace(/\s{2,}/g, ' ')                  // å¤šå€‹ç©ºæ ¼åˆä½µç‚ºä¸€å€‹
                .replace(/\s*:\s*/g, ':')                 // ç§»é™¤å†’è™Ÿå‘¨åœç©ºæ ¼
                .replace(/\s*,\s*/g, ',')                 // ç§»é™¤é€—è™Ÿå‘¨åœç©ºæ ¼
                .replace(/\s*{\s*/g, '{')                 // ç§»é™¤å¤§æ‹¬è™Ÿå‘¨åœç©ºæ ¼
                .replace(/\s*}\s*/g, '}')
                .replace(/\s*\[\s*/g, '[')                // ç§»é™¤ä¸­æ‹¬è™Ÿå‘¨åœç©ºæ ¼
                .replace(/\s*\]\s*/g, ']');
            
            console.log('Compact text:', compactText);
            
            try {
                const data = JSON.parse(compactText);
                console.log('å£“ç¸®å¾Œè§£ææˆåŠŸ:', data);
                return data;
            } catch (secondError) {
                console.error('å£“ç¸®è§£æå¤±æ•—:', secondError);
                
                // ç¬¬ä¸‰æ¬¡å˜—è©¦ï¼šæ›´ä¿å®ˆçš„è™•ç†
                let safeText = rawText
                    .replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g, '') // åªç§»é™¤çœŸæ­£çš„æ§åˆ¶å­—ç¬¦ï¼Œä¿ç•™æ›è¡Œ
                    .trim();
                
                console.log('Safe text:', safeText);
                
                try {
                    const data = JSON.parse(safeText);
                    console.log('å®‰å…¨è™•ç†è§£ææˆåŠŸ:', data);
                    return data;
                } catch (finalError) {
                    console.error('æ‰€æœ‰è§£æå˜—è©¦éƒ½å¤±æ•—:', finalError);
                    throw new Error(`JSON è§£æå¤±æ•—ã€‚æœ€å¾ŒéŒ¯èª¤: ${finalError.message}`);
                }
            }
        }
    })
    .then(data => {
        console.log('æ”¶åˆ°çš„è³‡æ–™:', data);
        
        if (data.success && data.data) {
            loadExistingData(data.data);
            alert('ç”¢å“è³‡æ–™è¼‰å…¥æˆåŠŸï¼');
        } else {
            console.log('è³‡æ–™æ ¼å¼å•é¡Œ:', data);
            alert('æ‰¾ä¸åˆ°æ­¤ç”¢å“ç³»çµ±IDçš„è³‡æ–™');
        }
    })
    .catch(error => {
        console.error('è¼‰å…¥å¤±æ•—è©³ç´°éŒ¯èª¤:', error);
        
        if (error.message.includes('JSON')) {
            alert('è³‡æ–™æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ Make.com å›å‚³çš„è³‡æ–™æ ¼å¼ã€‚è©³ç´°éŒ¯èª¤è«‹æŸ¥çœ‹ç€è¦½å™¨æ§åˆ¶å°ã€‚');
        } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
            alert('ç¶²è·¯è«‹æ±‚å¤±æ•—ï¼Œå¯èƒ½æ˜¯CORSå•é¡Œã€‚è«‹æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°æŸ¥çœ‹è©³ç´°éŒ¯èª¤ã€‚');
        } else {
            alert(`è¼‰å…¥å¤±æ•—: ${error.message}`);
        }
    })
    .finally(() => {
        loadBtn.disabled = false;
        loadBtn.textContent = 'è¼‰å…¥è³‡æ–™';
    });
}

// è¼‰å…¥ç¾æœ‰è³‡æ–™åˆ°è¡¨å–®
function loadExistingData(productData) {
    // è¼‰å…¥åŸºæœ¬è³‡è¨Šï¼ˆç”¢å“ç³»çµ±IDä¸éœ€è¦é‡æ–°è¼‰å…¥ï¼Œå› ç‚ºæ˜¯ç”¨æˆ¶è¼¸å…¥ç”¨ä¾†æŸ¥è©¢çš„ï¼‰
    document.getElementById('productModel').value = productData.productModel || '';
    
    // è¨­å®šåˆ†é¡ç³»çµ±ID
    const categorySelect = document.getElementById('categoryId');
    const categoryValue = productData.categoryId || '';
    
    // æª¢æŸ¥åˆ†é¡æ˜¯å¦å­˜åœ¨æ–¼é¸é …ä¸­
    let categoryExists = false;
    for (let option of categorySelect.options) {
        if (option.value === categoryValue) {
            categoryExists = true;
            break;
        }
    }
    
    if (categoryExists) {
        categorySelect.value = categoryValue;
    } else if (categoryValue) {
        // å¦‚æœåˆ†é¡ä¸å­˜åœ¨ï¼Œé¸æ“‡æ–°å¢é¸é …ä¸¦å¡«å…¥è‡ªè¨‚æ¬„ä½
        categorySelect.value = 'add_new';
        document.getElementById('customCategoryId').value = categoryValue;
        document.getElementById('customCategoryContainer').classList.add('show');
    }
    
    document.getElementById('productName').value = productData.productName || '';
    document.getElementById('maker').value = productData.maker || '';
    document.getElementById('model').value = (productData.model || '').replace(/\\n/g, '\n');
    document.getElementById('year').value = (productData.year || '').replace(/\\n/g, '\n');
    document.getElementById('oeNumber').value = (productData.oeNumber || '').replace(/\\n/g, '\n');
    document.getElementById('pins').value = productData.pins || '';
    document.getElementById('supplierInfo').value = productData.supplierInfo || '';
    
    // åœ¨æ›´æ–°æ¨¡å¼ä¸‹é–å®šç”¢å“å‹è™Ÿã€åˆ†é¡ç³»çµ±IDã€è‡ªè¨‚åˆ†é¡å’Œç”¢å“åç¨±ï¼ˆç”¢å“ç³»çµ±IDä¸é–å®šï¼‰
    document.getElementById('productModel').disabled = true;
    document.getElementById('categoryId').disabled = true;
    document.getElementById('customCategoryId').disabled = true;
    document.getElementById('productName').disabled = true;
    
    // è¼‰å…¥ Manual/Electric é¸é …
    if (productData.manualElectric) {
        document.querySelectorAll('input[name="manualElectric"]').forEach(radio => {
            if (radio.value === productData.manualElectric) {
                radio.checked = true;
            } else {
                radio.checked = false;
            }
        });
    }
    
    // è¼‰å…¥åŸå§‹è³‡æ–™
    document.getElementById('originalAlias').textContent = productData.alias || '-';
    document.getElementById('originalImage').textContent = productData.image || '-';
    document.getElementById('originalImageDesc').textContent = productData.imageDesc || '-';
    document.getElementById('originalDesc').textContent = productData.desc || '-';
    document.getElementById('originalApplication').textContent = productData.application || '-';
    document.getElementById('originalType').textContent = productData.type || '-';
    document.getElementById('originalPosition').textContent = productData.position || '-';
    document.getElementById('originalCountry').textContent = productData.country || '-';
    document.getElementById('originalWarranty').textContent = productData.warranty || '-';
    document.getElementById('originalTags').textContent = productData.tags || '-';
    
    // è¼‰å…¥AIæ¬„ä½
    document.getElementById('aiAlias').value = productData.alias || '';
    document.getElementById('aiImage').value = productData.image || '';
    document.getElementById('aiImageDesc').value = productData.imageDesc || '';
    document.getElementById('aiDesc').value = productData.desc || '';
    document.getElementById('aiApplication').value = productData.application || '';
    document.getElementById('aiType').value = productData.type || '';
    document.getElementById('aiPosition').value = productData.position || '';
    document.getElementById('aiCountry').value = productData.country || 'Made in Taiwan';
    document.getElementById('aiWarranty').value = productData.warranty || '12 Months';
    document.getElementById('aiTags').value = productData.tags || '';
    
    currentProductData = productData;
}

// ç”ŸæˆAIå…§å®¹
function generateAIContent() {
    const systemId = document.getElementById('systemId').value.trim();
    const productModel = document.getElementById('productModel').value.trim();
    const productName = document.getElementById('productName').value.trim();
    
    // å–å¾—åˆ†é¡ç³»çµ±IDï¼ˆè€ƒæ…®è‡ªè¨‚è¼¸å…¥ï¼‰
    let categoryId;
    const categorySelect = document.getElementById('categoryId');
    if (categorySelect.value === 'add_new') {
        categoryId = document.getElementById('customCategoryId').value.trim();
    } else {
        categoryId = categorySelect.value.trim();
    }
    
    if (!systemId || !productModel || !categoryId || !productName) {
        alert('è«‹å¡«å…¥å¿…å¡«æ¬„ä½ï¼ˆAã€Bã€Cã€Dæ¬„ï¼‰');
        return;
    }
    
    showLoading();
    
    const requestData = {
        action: "generate_all",
        systemId: systemId,
        productModel: productModel,
        categoryId: categoryId,
        productName: productName,
        maker: document.getElementById('maker').value.trim(),
        model: document.getElementById('model').value.trim(),
        year: document.getElementById('year').value.trim(),
        oeNumber: document.getElementById('oeNumber').value.trim(),
        pins: document.getElementById('pins').value.trim()
    };
    
    // å–å¾—é¸ä¸­çš„ Manual/Electric
    const manualElectricInputs = document.querySelectorAll('input[name="manualElectric"]');
    let selectedManualElectric = null;
    manualElectricInputs.forEach(input => {
        if (input.checked) {
            selectedManualElectric = input.value;
        }
    });
    if (selectedManualElectric) {
        requestData.manualElectric = selectedManualElectric;
    }
    
    const supplierInfo = document.getElementById('supplierInfo').value.trim();
    if (supplierInfo) {
        requestData.supplierInfo = supplierInfo;
    }
    
    if (isUpdateMode && currentProductData) {
        requestData.existingData = currentProductData;
    }
    
    console.log('ç™¼é€AIç”Ÿæˆè«‹æ±‚:', requestData);
    
    fetch('https://hook.us2.make.com/l58tvefkmb0bqmpl2cpqr1ocvyejk0is', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData)
    })
    .then(response => {
        console.log('AI Response status:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return response.text();
    })
    .then(rawText => {
        console.log('AI Raw response:', rawText);
        
        const cleanText = rawText
            .replace(/[\u0000-\u001F\u007F-\u009F]/g, '')
            .replace(/\r\n/g, '\\n')
            .replace(/\r/g, '\\n')
            .replace(/\n/g, '\\n')
            .replace(/\t/g, '\\t');
        
        const data = JSON.parse(cleanText);
        return data;
    })
    .then(data => {
        console.log('AIç”Ÿæˆçµæœ:', data);
        
        if (data.success && data.generated) {
            fillAIGeneratedContent(data.generated);
            alert('AIæ–‡æ¡ˆç”ŸæˆæˆåŠŸï¼');
        } else {
            alert('AIç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
        }
    })
    .catch(error => {
        console.error('AIç”Ÿæˆå¤±æ•—:', error);
        alert(`AIç”Ÿæˆå¤±æ•—: ${error.message}`);
    })
    .finally(() => {
        hideLoading();
    });
}

// å¡«å…¥AIç”Ÿæˆçš„å…§å®¹
function fillAIGeneratedContent(generated) {
    if (generated.alias) document.getElementById('aiAlias').value = generated.alias;
    if (generated.image) document.getElementById('aiImage').value = generated.image;
    if (generated.imageDesc) document.getElementById('aiImageDesc').value = generated.imageDesc;
    if (generated.desc) document.getElementById('aiDesc').value = generated.desc;
    if (generated.application) document.getElementById('aiApplication').value = generated.application;
    if (generated.position) document.getElementById('aiPosition').value = generated.position;
    if (generated.tags) document.getElementById('aiTags').value = generated.tags;
    
    // Type æ¬„ä½ç”±å‰ç«¯ JavaScript ç”Ÿæˆï¼Œä¸ä½¿ç”¨ AI å›å‚³çš„å€¼
    generateTypeField();
    
    // ç¢ºä¿å›ºå®šå€¼æ­£ç¢ºè¨­ç½®
    document.getElementById('aiCountry').value = 'Made in Taiwan';
    document.getElementById('aiWarranty').value = '12 Months';
}

// é‡æ–°ç”Ÿæˆç‰¹å®šæ¬„ä½
function refreshField(fieldName) {
    const button = event.target;
    button.disabled = true;
    button.textContent = 'ğŸ”„ ç”Ÿæˆä¸­...';
    
    const systemId = document.getElementById('systemId').value.trim();
    const productModel = document.getElementById('productModel').value.trim();
    const productName = document.getElementById('productName').value.trim();
    
    if (!systemId || !productModel || !productName) {
        alert('è«‹å…ˆå¡«å…¥ç”¢å“ç³»çµ±IDã€ç”¢å“å‹è™Ÿå’Œç”¢å“åç¨±');
        button.disabled = false;
        button.textContent = 'ğŸ”„ é‡æ–°ç”Ÿæˆ';
        return;
    }
    
    const requestData = {
        action: "generate_field",
        fieldName: fieldName,
        systemId: systemId,
        productModel: productModel,
        productName: productName,
        maker: document.getElementById('maker').value.trim(),
        model: document.getElementById('model').value.trim(),
        year: document.getElementById('year').value.trim(),
        oeNumber: document.getElementById('oeNumber').value.trim(),
        pins: document.getElementById('pins').value.trim()
    };
    
    // å–å¾—é¸ä¸­çš„ Manual/Electric
    const manualElectricInputs = document.querySelectorAll('input[name="manualElectric"]');
    let selectedManualElectric = null;
    manualElectricInputs.forEach(input => {
        if (input.checked) {
            selectedManualElectric = input.value;
        }
    });
    if (selectedManualElectric) {
        requestData.manualElectric = selectedManualElectric;
    }
    
    const supplierInfo = document.getElementById('supplierInfo').value.trim();
    if (supplierInfo) {
        requestData.supplierInfo = supplierInfo;
    }
    
    const currentValue = getCurrentFieldValue(fieldName);
    if (currentValue) {
        requestData.currentValue = currentValue;
    }
    
    console.log('å€‹åˆ¥æ¬„ä½é‡æ–°ç”Ÿæˆè«‹æ±‚:', requestData);
    
    fetch('https://hook.us2.make.com/l58tvefkmb0bqmpl2cpqr1ocvyejk0is', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.text();
    })
    .then(rawText => {
        const cleanText = rawText
            .replace(/[\u0000-\u001F\u007F-\u009F]/g, '')
            .replace(/\r\n/g, '\\n')
            .replace(/\r/g, '\\n')
            .replace(/\n/g, '\\n')
            .replace(/\t/g, '\\t');
        
        const data = JSON.parse(cleanText);
        return data;
    })
    .then(data => {
        console.log(`${fieldName} é‡æ–°ç”Ÿæˆçµæœ:`, data);
        
        if (data.success && data.generated) {
            updateSpecificField(fieldName, data.generated[fieldName]);
        } else {
            alert('é‡æ–°ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
        }
    })
    .catch(error => {
        console.error('é‡æ–°ç”Ÿæˆå¤±æ•—:', error);
        alert(`é‡æ–°ç”Ÿæˆå¤±æ•—: ${error.message}`);
    })
    .finally(() => {
        button.disabled = false;
        button.textContent = 'ğŸ”„ é‡æ–°ç”Ÿæˆ';
    });
}

// å–å¾—ç•¶å‰æ¬„ä½å€¼
function getCurrentFieldValue(fieldName) {
    const fieldMap = {
        'alias': 'aiAlias',
        'desc': 'aiDesc', 
        'application': 'aiApplication',
        'tags': 'aiTags'
    };
    
    const elementId = fieldMap[fieldName];
    if (elementId) {
        const element = document.getElementById(elementId);
        return element ? element.value : '';
    }
    return '';
}

// æ›´æ–°ç‰¹å®šæ¬„ä½
function updateSpecificField(fieldName, newValue) {
    const fieldMap = {
        'alias': 'aiAlias',
        'desc': 'aiDesc',
        'application': 'aiApplication',
        'tags': 'aiTags'
    };
    
    const elementId = fieldMap[fieldName];
    if (elementId && newValue) {
        const element = document.getElementById(elementId);
        if (element) {
            element.value = newValue;
        }
    }
}

// é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
function showLoading() {
    document.getElementById('loadingDiv').classList.add('show');
    document.getElementById('generateBtn').disabled = true;
    document.getElementById('generateBtn').textContent = 'ğŸ¤– ç”Ÿæˆä¸­...';
}

// éš±è—è¼‰å…¥ç‹€æ…‹
function hideLoading() {
    document.getElementById('loadingDiv').classList.remove('show');
    document.getElementById('generateBtn').disabled = false;
    document.getElementById('generateBtn').textContent = 'ğŸ¤– ç”ŸæˆAIæ–‡æ¡ˆ';
}

// åˆ‡æ›å€å¡Šé¡¯ç¤º/éš±è—
function toggleSection(element) {
    const section = element.parentElement;
    section.classList.toggle('collapsed');
}

// é è¦½è³‡æ–™
function previewData() {
    const data = collectFormData();
    
    if (!data.systemId || !data.productName) {
        alert('è«‹è‡³å°‘å¡«å…¥ç”¢å“ç³»çµ±IDå’Œç”¢å“åç¨±æ‰èƒ½é è¦½');
        return;
    }
    
    const previewWindow = window.open('', '_blank', 'width=1200,height=800,scrollbars=yes');
    previewWindow.document.write(generateProductPreviewHTML(data));
}

// ç”Ÿæˆé è¦½HTML
function generateProductPreviewHTML(data) {
    return `
        <!DOCTYPE html>
        <html lang="zh-TW">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>${data.productName} | ç”¢å“é è¦½</title>
            <style>
                * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }
                
                body {
                    font-family: Arial, sans-serif;
                    line-height: 1.6;
                    color: #333;
                    background: white;
                }
                
                .preview-header {
                    background: linear-gradient(135deg, #C5705D 0%, #A85A47 100%);
                    color: white;
                    padding: 10px 0;
                    text-align: center;
                    font-size: 14px;
                    font-weight: bold;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                }
                
                .container {
                    max-width: 1000px;
                    margin: 0 auto;
                    padding: 20px;
                }
                
                .product-header {
                    display: flex;
                    gap: 30px;
                    margin-bottom: 30px;
                    padding-bottom: 30px;
                    border-bottom: 1px solid #eee;
                }
                
                .product-images {
                    flex: 0 0 300px;
                }
                
                .main-image {
                    width: 100%;
                    height: 250px;
                    background: white;
                    border: 1px solid #ddd;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 15px;
                    border-radius: 4px;
                }
                
                .main-image img {
                    max-width: 100%;
                    max-height: 100%;
                    object-fit: contain;
                }
                
                .image-placeholder {
                    color: #999;
                    font-size: 16px;
                }
                
                .product-info {
                    flex: 1;
                }
                
                .product-title {
                    font-size: 28px;
                    color: #333;
                    margin-bottom: 15px;
                    font-weight: 600;
                    line-height: 1.3;
                }
                
                .product-model {
                    color: #C5705D;
                    margin-bottom: 8px;
                    font-size: 16px;
                    font-weight: 600;
                }
                
                .product-alias {
                    color: #666;
                    margin-bottom: 8px;
                    font-size: 14px;
                    line-height: 1.4;
                }
                
                .description {
                    font-size: 14px;
                    line-height: 1.6;
                    color: #555;
                    margin-bottom: 15px;
                    text-align: justify;
                }
                
                .action-buttons {
                    display: flex;
                    gap: 15px;
                    margin-bottom: 20px;
                }
                
                .action-button {
                    padding: 12px 20px;
                    border: none;
                    border-radius: 4px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                .inquire-btn {
                    background: #C5705D;
                    color: white;
                }
                
                .add-list-btn {
                    background: #8B7D82;
                    color: white;
                }
                
                .specs-section {
                    margin-top: 30px;
                }
                
                .specs-group {
                    margin-bottom: 20px;
                }
                
                .specs-title {
                    font-size: 16px;
                    font-weight: 600;
                    color: #333;
                    margin-bottom: 8px;
                    text-transform: uppercase;
                }
                
                .specs-item {
                    color: #666;
                    font-size: 14px;
                    margin-left: 15px;
                    position: relative;
                }
                
                .specs-item::before {
                    content: "â—";
                    position: absolute;
                    left: -15px;
                    color: #C5705D;
                }
                
                .close-button {
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #C5705D;
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 12px;
                    z-index: 1000;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                }
                
                .close-button:hover {
                    background: #A85A47;
                }
                
                @media (max-width: 768px) {
                    .product-header {
                        flex-direction: column;
                        gap: 20px;
                    }
                    
                    .product-images {
                        flex: none;
                    }
                    
                    .container {
                        padding: 15px;
                    }
                }
            </style>
        </head>
        <body>
            <div class="preview-header">
                Product Page Preview - Simulate Official Website Display
            </div>
            
            <button class="close-button" onclick="window.close()">Close</button>
            
            <div class="container">
                <div class="product-header">
                    <div class="product-images">
                        <div class="main-image">
                            ${data.image ? 
                                `<img src="${data.image}" alt="${data.productName}">` : 
                                `<div class="image-placeholder">Product Main Image</div>`
                            }
                        </div>
                    </div>
                    
                    <div class="product-info">
                        <h1 class="product-title">${data.productName || 'Product Name To Be Set'}</h1>
                        
                        <div class="product-model">
                            ${data.productModel || 'Product Model To Be Set'}
                        </div>
                        
                        ${data.alias ? `
                            <div class="product-alias">
                                ${data.alias}
                            </div>
                        ` : ''}
                        
                        ${data.desc ? `
                            <div class="description">
                                ${data.desc.replace(/\n/g, '<br>')}
                            </div>
                        ` : ''}
                        
                        <div class="action-buttons">
                            <button class="action-button inquire-btn">INQUIRE NOW</button>
                            <button class="action-button add-list-btn">ADD TO LIST</button>
                        </div>
                    </div>
                </div>
                
                <div class="specs-section">
                    ${data.maker ? `
                        <div class="specs-group">
                            <div class="specs-title">MAKER</div>
                            <div class="specs-item">${data.maker}</div>
                        </div>
                    ` : ''}
                    
                    ${data.model ? `
                        <div class="specs-group">
                            <div class="specs-title">MODEL</div>
                            <div class="specs-item">${data.model.replace(/\\n/g, '<br>')}</div>
                        </div>
                    ` : ''}
                    
                    ${data.year ? `
                        <div class="specs-group">
                            <div class="specs-title">YEAR</div>
                            <div class="specs-item">${data.year.replace(/\\n/g, '<br>')}</div>
                        </div>
                    ` : ''}
                    
                    ${data.application ? `
                        <div class="specs-group">
                            <div class="specs-title">Applications</div>
                            <div class="specs-item">${data.application.replace(/\n/g, '<br>')}</div>
                        </div>
                    ` : ''}
                    
                    ${data.type ? `
                        <div class="specs-group">
                            <div class="specs-title">Type</div>
                            <div class="specs-item">${data.type}</div>
                        </div>
                    ` : ''}
                    
                    ${data.position ? `
                        <div class="specs-group">
                            <div class="specs-title">Position</div>
                            <div class="specs-item">${data.position}</div>
                        </div>
                    ` : ''}
                    
                    ${data.pins ? `
                        <div class="specs-group">
                            <div class="specs-title">PINs</div>
                            <div class="specs-item">${data.pins}</div>
                        </div>
                    ` : ''}
                    
                    ${data.manualElectric ? `
                        <div class="specs-group">
                            <div class="specs-title">Manual/Electric</div>
                            <div class="specs-item">${data.manualElectric}</div>
                        </div>
                    ` : ''}
                    
                    <div class="specs-group">
                        <div class="specs-title">Country of Origin</div>
                        <div class="specs-item">${data.country || 'Made in Taiwan'}</div>
                    </div>
                    
                    ${data.oeNumber ? `
                        <div class="specs-group">
                            <div class="specs-title">OE#</div>
                            ${(() => {
                                // Handle both \\n and \n line breaks
                                let oeLines = data.oeNumber.includes('\\n') ? 
                                    data.oeNumber.split('\\n') : 
                                    data.oeNumber.split('\n');
                                
                                // Filter out empty lines and create spec items
                                return oeLines
                                    .map(line => line.trim())
                                    .filter(line => line)
                                    .map(line => `<div class="specs-item">${line}</div>`)
                                    .join('');
                            })()}
                        </div>
                    ` : ''}
                    
                    <div class="specs-group">
                        <div class="specs-title">Warranty</div>
                        <div class="specs-item">${data.warranty || '12 Months'}</div>
                    </div>
                </div>
            </div>
        </body>
        </html>
    `;
}

// æ”¶é›†è¡¨å–®è³‡æ–™
function collectFormData() {
    // å–å¾—åˆ†é¡ç³»çµ±IDï¼ˆè€ƒæ…®è‡ªè¨‚è¼¸å…¥å’Œdisabledç‹€æ…‹ï¼‰
    let categoryId;
    const categorySelect = document.getElementById('categoryId');
    const customCategoryInput = document.getElementById('customCategoryId');
    
    if (categorySelect.disabled && customCategoryInput.value.trim()) {
        // ä¿®æ”¹æ¨¡å¼ä¸‹ï¼Œå¦‚æœåˆ†é¡è¢«é–å®šä¸”è‡ªè¨‚æ¬„ä½æœ‰å€¼ï¼Œä½¿ç”¨è‡ªè¨‚æ¬„ä½çš„å€¼
        categoryId = customCategoryInput.value.trim();
    } else if (categorySelect.value === 'add_new') {
        categoryId = customCategoryInput.value.trim();
    } else {
        categoryId = categorySelect.value.trim();
    }
    
    // å–å¾—é¸ä¸­çš„ Manual/Electric
    const manualElectricInputs = document.querySelectorAll('input[name="manualElectric"]');
    let selectedManualElectric = '';
    manualElectricInputs.forEach(input => {
        if (input.checked) {
            selectedManualElectric = input.value;
        }
    });
    
    return {
        systemId: document.getElementById('systemId').value.trim(),
        categoryId: categoryId,
        productName: document.getElementById('productName').value.trim(),
        productModel: document.getElementById('productModel').value.trim(),
        maker: document.getElementById('maker').value.trim(),
        model: document.getElementById('model').value.trim().replace(/\n/g, '\\n'),
        year: document.getElementById('year').value.trim().replace(/\n/g, '\\n'),
        oeNumber: document.getElementById('oeNumber').value.trim().replace(/\n/g, '\\n'),
        pins: document.getElementById('pins').value.trim(),
        manualElectric: selectedManualElectric,
        supplierInfo: document.getElementById('supplierInfo').value.trim(),
        alias: document.getElementById('aiAlias').value,
        image: document.getElementById('aiImage').value,
        imageDesc: document.getElementById('aiImageDesc').value,
        desc: document.getElementById('aiDesc').value,
        application: document.getElementById('aiApplication').value,
        type: document.getElementById('aiType').value,
        position: document.getElementById('aiPosition').value,
        country: document.getElementById('aiCountry').value,
        warranty: document.getElementById('aiWarranty').value,
        tags: document.getElementById('aiTags').value
    };
}

// å„²å­˜è³‡æ–™
function saveData() {
    const data = collectFormData();
    
    // ç‰¹åˆ¥è™•ç†ä¿®æ”¹æ¨¡å¼ä¸‹çš„åˆ†é¡IDå•é¡Œ
    if (isUpdateMode && !data.categoryId) {
        const customCategoryInput = document.getElementById('customCategoryId');
        if (customCategoryInput && customCategoryInput.value.trim()) {
            data.categoryId = customCategoryInput.value.trim();
            console.log('ä¿®æ­£åˆ†é¡IDç‚º:', data.categoryId);
        }
    }
    
    // æ·»åŠ èª¿è©¦ä¿¡æ¯
    console.log('æ”¶é›†åˆ°çš„è³‡æ–™:', data);
    
    // æª¢æŸ¥å¿…å¡«æ¬„ä½ä¸¦çµ¦å‡ºæ˜ç¢ºæç¤º
    const missingFields = [];
    
    if (!data.systemId) {
        missingFields.push('ç”¢å“ç³»çµ±ID(Aæ¬„)');
    }
    
    if (!data.categoryId) {
        missingFields.push('åˆ†é¡ç³»çµ±ID(Bæ¬„)');
    }
    
    if (!data.productName) {
        missingFields.push('ç”¢å“åç¨±(Cæ¬„)');
    }
    
    if (!data.productModel) {
        missingFields.push('ç”¢å“å‹è™Ÿ(Dæ¬„)');
    }
    
    if (missingFields.length > 0) {
        alert(`è«‹å¡«å…¥ä»¥ä¸‹å¿…å¡«æ¬„ä½ï¼š\n\n${missingFields.join('\n')}`);
        return;
    }
    
    const action = isUpdateMode ? 'æ›´æ–°' : 'æ–°å¢';
    if (!confirm(`ç¢ºå®šè¦${action}æ­¤ç”¢å“è³‡æ–™å—ï¼Ÿ`)) {
        return;
    }
    
    const saveData = {
        action: isUpdateMode ? "update_product" : "save_product",
        mode: isUpdateMode ? "update" : "new",  
        systemId: data.systemId,
        productModel: data.productModel,
        categoryId: data.categoryId,
        productName: data.productName,
        maker: data.maker,
        model: data.model,
        year: data.year,
        oeNumber: data.oeNumber,
        pins: data.pins,
        manualElectric: data.manualElectric,
        supplierInfo: data.supplierInfo,
        alias: data.alias,
        image: data.image,
        imageDesc: data.imageDesc,
        desc: data.desc,
        application: data.application,
        type: data.type,
        position: data.position,
        country: data.country,
        warranty: data.warranty,
        tags: data.tags
    };
    
    console.log('å„²å­˜è³‡æ–™:', saveData);
    
    const saveBtn = document.querySelector('.save-btn');
    const originalText = saveBtn.textContent;
    saveBtn.disabled = true;
    saveBtn.textContent = 'å„²å­˜ä¸­...';
    
    fetch('https://hook.us2.make.com/iuanoo5ktyxgs7vtyhvunwbxieepgt1u', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(saveData)
    })
    .then(response => {
        console.log('Save response status:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return response.text();
    })
    .then(rawText => {
        console.log('Save response:', rawText);
        
        const cleanText = rawText
            .replace(/[\u0000-\u001F\u007F-\u009F]/g, '')
            .replace(/\r\n/g, '\\n')
            .replace(/\r/g, '\\n')
            .replace(/\n/g, '\\n')
            .replace(/\t/g, '\\t');
        
        const result = JSON.parse(cleanText);
        return result;
    })
    .then(result => {
        if (result.success) {
            alert(`ç”¢å“è³‡æ–™å·²${action}æˆåŠŸï¼`);
            
            if (isUpdateMode) {
                if (confirm('æ˜¯å¦è¦æ¸…ç©ºè¡¨å–®ä»¥ä¿®æ”¹ä¸‹ä¸€å€‹ç”¢å“ï¼Ÿ')) {
                    clearForm();
                }
            } else {
                if (confirm('æ˜¯å¦è¦æ¸…ç©ºè¡¨å–®ä»¥æ–°å¢ä¸‹ä¸€å€‹ç”¢å“ï¼Ÿ')) {
                    clearForm();
                }
            }
        } else {
            alert(`å„²å­˜å¤±æ•—: ${result.message || 'æœªçŸ¥éŒ¯èª¤'}`);
        }
    })
    .catch(error => {
        console.error('å„²å­˜å¤±æ•—:', error);
        alert(`å„²å­˜å¤±æ•—: ${error.message}`);
    })
    .finally(() => {
        saveBtn.disabled = false;
        saveBtn.textContent = originalText;
    });
}

// æ¸…ç©ºè¡¨å–®
function clearForm() {
    if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
        return;
    }
    
    // æ¸…ç©ºåŸºæœ¬æ¬„ä½
    document.getElementById('systemId').value = '';
    document.getElementById('productModel').value = '';
    document.getElementById('productName').value = '';
    document.getElementById('maker').value = '';
    document.getElementById('model').value = '';
    document.getElementById('year').value = '';
    document.getElementById('oeNumber').value = '';
    document.getElementById('pins').value = '';
    document.getElementById('supplierInfo').value = '';
    
    // é‡è¨­åˆ†é¡é¸æ“‡
    const categorySelect = document.getElementById('categoryId');
    categorySelect.value = '';
    document.getElementById('customCategoryId').value = '';
    document.getElementById('customCategoryContainer').classList.remove('show');
    
    // æ¸…ç©º Manual/Electric é¸é …
    document.querySelectorAll('input[name="manualElectric"]').forEach(radio => {
        radio.checked = false;
    });
    
    // æ¸…ç©ºAIæ¬„ä½
    const aiFields = [
        'aiAlias', 'aiImage', 'aiImageDesc', 
        'aiDesc', 'aiApplication', 'aiType', 'aiPosition', 'aiTags'
    ];
    
    aiFields.forEach(field => {
        const element = document.getElementById(field);
        if (element) {
            element.value = '';
        }
    });
    
    // é‡è¨­å›ºå®šå€¼
    document.getElementById('aiCountry').value = 'Made in Taiwan';
    document.getElementById('aiWarranty').value = '12 Months';
    
    // æ¸…ç©ºåŸå§‹è³‡æ–™
    const originalFields = [
        'originalAlias', 'originalImage', 'originalImageDesc',
        'originalDesc', 'originalApplication', 'originalType', 'originalPosition', 
        'originalCountry', 'originalWarranty', 'originalTags'
    ];
    
    originalFields.forEach(field => {
        const element = document.getElementById(field);
        if (element) {
            element.textContent = '-';
        }
    });
    
    // æ¸…ç©ºç•¶å‰ç”¢å“è³‡æ–™
    currentProductData = {};
    
    // æ ¹æ“šç•¶å‰æ¨¡å¼æ±ºå®šå¾ŒçºŒè¡Œç‚º
    if (isUpdateMode) {
        // ä¿®æ”¹æ¨¡å¼ä¸‹æ¸…ç©ºå¾Œï¼Œè§£é–ç›¸é—œæ¬„ä½ä»¥ä¾¿è¼‰å…¥æ–°ç”¢å“
        document.getElementById('systemId').disabled = false;
        document.getElementById('productModel').disabled = false;
        document.getElementById('categoryId').disabled = false;
        document.getElementById('customCategoryId').disabled = false;
        document.getElementById('productName').disabled = false;
    }
    
    // é‡æ–°è¼‰å…¥åˆ†é¡é¸é …
    loadCategoryOptions();
}
</script>
</body>
</html>
